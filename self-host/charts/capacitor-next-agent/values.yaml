image:
  repository: ghcr.io/gimlet-io/capacitor-next
  tag: agent-0.14.0-rc.3
  pullPolicy: IfNotPresent

replicaCount: 1

# Environment variables to configure all aspects of Capacitor Next Agent
env:
  # BACKEND_WS_URL: "wss://capacitor.example.com/agent/connect"
  # CLUSTER_ID: "production-cluster"

resources:
  requests:
    cpu: "50m"
    memory: "64Mi"
  limits:
    cpu: "200m"
    memory: "256Mi"

podLabels: {}
podAnnotations: {}

configmapLabels: {}
configmapAnnotations: {}

serviceAccount:
  create: true
  name: capacitor-next-agent
  labels: {}
  annotations: {}

nodeSelector: {}

tolerations: []

affinity: {}

# Permission Elevation
# Useful for read-only setups where certain operational actions should be allowed
# without granting users direct RBAC permissions. When enabled on the backend,
# these actions bypass user impersonation and use the agent's service account's
# elevated RBAC. These settings must match the backend's permissionElevation settings.
# Specify a list of namespaces to limit the scope. Use ["*"] for all namespaces (not recommended).
# Read the [Authorization](https://gimlet.io/capacitor-next/docs/#permission-elevation) docs for more information.
permissionElevation:
  # Namespaces where pod deletion and deployment/statefulset/daemonset rollout restart are allowed
  # Example: ["flux-system", "default"] or ["*"] for all namespaces
  workloadRestartNamespaces: []
  # Namespaces where triggering FluxCD reconciliation is allowed
  # Example: ["flux-system"] or ["*"] for all namespaces
  fluxReconciliationNamespaces: []

# Existing secret configuration
# If specified, both the chart environment variables from `env`
# and the existing secret are loaded. The existing secret is loaded last,
# allowing it to override values from the `env` value,
# if they share the same keys.
existingSecret:
  name: ""  # Name of the existing secret to use

# Security context configuration
securityContext:
  enabled: true
  pod:
    runAsNonRoot: true
    runAsUser: 1000
    seccompProfile:
      type: RuntimeDefault
  container:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
